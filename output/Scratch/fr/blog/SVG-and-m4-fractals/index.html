<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="fr" xml:lang="fr">
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
        
        
        <meta name="keywords" content="m4, SVG, XSLT, XML, design, programmation, fractales">
        
        <link rel="shortcut icon" type="image/x-icon" href="/Scratch/img/favicon.ico" />
        <link rel="stylesheet" type="text/css" href="/Scratch/assets/css/main.css" />
        <link rel="stylesheet" type="text/css" href="/Scratch/css/solarized.css" />
        <link rel="stylesheet" type="text/css" href="/Scratch/css/idc.css" />
        <link href='http://fonts.googleapis.com/css?family=Inconsolata' rel='stylesheet' type='text/css'>
        <link rel="alternate" type="application/rss+xml" title="RSS" href="http://feeds.feedburner.com/yannespositocomfr"/>
        
        <link rel="alternate" lang="fr" xml:lang="fr" title="Accroître le pouvoir des languages déficients." type="text/html" hreflang="fr" href="/Scratch/fr/blog/SVG-and-m4-fractals/" /> 
        <link rel="alternate" lang="en" xml:lang="en" title="Increase the power of deficient languages." type="text/html" hreflang="en" href="/Scratch/en/blog/SVG-and-m4-fractals/" /> 
        <script type="text/javascript" src="/Scratch/js/jquery-1.3.1.min.js"></script>
        <script type="text/javascript" src="/Scratch/js/jquery.cookie.js"></script>
        <script type="text/javascript" src="/Scratch/js/index.js"></script>
        <script type="text/javascript" src="/Scratch/js/highlight/highlight.pack.js"></script>                 
        <script type="text/javascript" src="/Scratch/js/article.js"></script>                 
        <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
        <!--[if lt IE 9]>
        <script src="http://ie7-js.googlecode.com/svn/version/2.1(beta4)/IE9.js"></script>
        <![endif]-->
        <title>Accroître le pouvoir des languages déficients.</title>
    </head>
    <body lang="fr" class="article">
        <script type="text/javascript">// <![CDATA[
            document.write('<div id="blackpage"><img src="/Scratch/img/loading.gif" alt="Chargement en cours..."/></div>');
            // ]]>
        </script>

        <div id="content">
            <div id="choix"> 
                <div class="return"><a href="#entete">&darr; Menu &darr;</a></div>
                <div id="choixlang"><a href="/Scratch/en/blog/SVG-and-m4-fractals/" onclick="setLanguage('en')">in English</a>
                </div>
                <div class="flush"></div>
            </div>
            <div id="titre">
                <h1>
                    Accroître le pouvoir des languages déficients.
                </h1>
                 
                <h2>
                    Fractales en SVG avec m4 
                </h2>
                
            </div>
            <div class="flush"></div>

            

            

            <div class="flush"></div>
            <div id="afterheader">
                <div class="corps">
                    <p><img alt="Yesod logo made in SVG and m4" src="/Scratch/img/blog/SVG-and-m4-fractals/main.png" /></p>


<div class="intro">


<p><span class="sc"><abbr title="Trop long à lire">tlàl</abbr>&nbsp;: </span> Utiliser m4 pour accroître le pouvoir d&rsquo;<span class="sc">xslt</span> et d&rsquo;<span class="sc">svg</span>. Example cool, les fractales.</p>


</div>


<p>Lorsqu&rsquo;<span class="sc">xml</span> fût inventé beaucoup pensaient que c&rsquo;était l&rsquo;avenir.
Passer de fichiers plat à des fichiers structurés standardisés fût un grand progrès dans beaucoup de domaines.
Cerain se mirent à voir du <span class="sc">xml</span> de partout.
À tel point que les les format compatibles <span class="sc">xml</span> naquirent de toute part.
Non seulement comme format de fichier, mais aussi comme format pour un langage de programmation.</p>

<p>Ô joie&nbsp;!</p>

<p>Malheureusement, <span class="sc">xml</span> fût fabriquer pour le transfert de données.
Pas du tout pour être vu ou édité directement.
La triste vérité est qu&rsquo;<span class="sc">xml</span> est verbeux et laid.
Dans un monde parfait, nous ne devrions avoir des programmes qui s&rsquo;occupent de nous afficher correctement le <span class="sc">xml</span> pour nous épargner la peine de les voir directement.
Mais devinez quoi&nbsp;?
Notre monde n&rsquo;est pas parfait. 
Beaucoup de programmeurs sont ainsi forcé de travailler
directement avec de l&rsquo;<span class="sc">xml</span>.</p>

<p><span class="sc">xml</span>, n&rsquo;est pas le seul cas de format mal utilisé que je connaisse.
Vous avez d&rsquo;autres formats dans lesquels il serait très agréable d&rsquo;ajouter des variables, des boucles, des fonctions&hellip;</p>

<p>Mais je suis là pour vous aider.
Si comme moi vous détestez <span class="sc">xslt</span> ou écrire de l&rsquo;<span class="sc">xml</span>.
Je vais vous montrer une façon d&rsquo;améliorer tout ça.</p>

<h2 id="un-exemple-avec-span-classscxsltspan">Un exemple avec <span class="sc">xslt</span></h2>

<p>Commençons avec le pire cas de langage <span class="sc">xml</span> que je connaisse&nbsp;: <span class="sc">xslt</span>.
Tous les développeurs qui ont déjà dû écrire du <span class="sc">xslt</span> savent à quel point ce langage est horrible.</p>

<p>Pour réduire la &ldquo;verbosité&rdquo; de tels langages, il y a un moyen.
<strong><code>m4</code></strong>.
Oui, le préprocesseur utilisé par <code>C</code> et <code>C++</code>.</p>

<p>Voici certains exemples&nbsp;:</p>

<ul>
  <li>Les variables, au lieu d&rsquo;écrire <code>myvar = value</code>, voici la version <span class="sc">xslt</span>&nbsp;:</li>
</ul>

<pre><code class="xml">&lt;xsl:variable name="myvar" select="value"/&gt;
</code></pre>

<ul>
  <li>Afficher quelquechose. Au lieu de <code>print "Hello world!"</code>, <span class="sc">xslt</span> nous offre&nbsp;:</li>
</ul>

<pre><code class="xml">&lt;xsl:text 
    disable-output-escaping="yes"&gt;&lt;![CDATA[Hello world!
]]&gt;&lt;/xsl:text&gt;
</code></pre>

<ul>
  <li>afficher la valeur d&rsquo;une variable, au lieu de <code>print myvar</code>, nous avons droit à&nbsp;:</li>
</ul>

<pre><code class="xml">&lt;xslt:value-of select="myvar"/&gt;
</code></pre>

<ul>
  <li>Essayez d&rsquo;imaginer à quel point il est verbeux de déclarer une fonction dans ce langage.</li>
</ul>

<h2 id="la-solution-m4--la-rescousse">La solution (m4 à la rescousse)</h2>

<pre><code class="xml">&lt;?xml version="1.0" standalone="yes"?&gt; &lt;!-- YES its <span class="sc">xml</span> --&gt;
&lt;!-- ← start a comment, then write some m4 directives:

define(`ydef',`&lt;xsl:variable name="$1" select="$2"/&gt;')
define(`yprint',`&lt;xsl:text disable-output-escaping="yes"&gt;&lt;![CDATA[$1]]&gt;&lt;/xsl:text&gt;')
define(`yshow',`&lt;xsl:value-of select="$1"/&gt;')

--&gt;
&lt;!-- Yes, <span class="sc">xml</span> sucks to be read --&gt;
&lt;xsl:stylesheet version="1.0" xmlns:xsl="http://www.w3.org/1999/XSL/Transform"&gt;
&lt;!-- And it sucks even more to edit --&gt;
&lt;xsl:template match="/"&gt;
    ydef(myvar,value)
    yprint(Hello world!)
    yshow(myvar)
&lt;/xsl:template&gt;
</code></pre>

<p>Maintenant compilons simplement ce fichier&nbsp;:</p>

<pre><code class="zsh">m4 myfile.m4 &gt; myfile.xslt
</code></pre>

<p>Et vous pouvez profitez&nbsp;! Maintenant <span class="sc">xslt</span> devient plus lisible et plus facile à éditer.</p>

<h2 id="la-partie-la-plus-cool-les-fractales-">La partie la plus cool: les fractales&nbsp;!</h2>

<p>À ses débuts, beaucoup pensaient que ce serait le nouveau Flash. Apparemment, ce devrait plutôt être <code>canvas</code> avec du javascript qui occupera cette place.</p>

<p>Tout d&rsquo;abord, laissez moi vous montrer le résultat&nbsp;:</p>

<p><a href="blogimagedirmain.svg">
<img alt="Yesod logo made in SVG and m4" src="/Scratch/img/blog/SVG-and-m4-fractals/main.png" />
Cliquez sur l&rsquo;image pour voir le <span class="sc">svg</span> directement. Attention, si vous n&rsquo;avez pas un ordinateur récent, ça risque de ramer.
</a></p>

<p>Le positionnement du texte &ldquo;esod&rdquo; par rapport au &ldquo;λ&rdquo; renversé a été en jouant avec firebug. De cette façon je n&rsquo;avais pas à regénérer pour tester.</p>

<p>Faire une telle fractale revient à&nbsp;:</p>

<ol>
  <li>Choisir un élément racine&nbsp;;</li>
  <li>le dupliquer et le transformer&nbsp;;</li>
  <li>le résultat est un nouveau sous-élément&nbsp;;</li>
  <li>répéter à partir de 2 mais en utilisant le sous-élément comme nouvelle racine.</li>
  <li>Arréter lorsque la récursion est assez profonde.</li>
</ol>

<p>Si j&rsquo;avais dû faire ça manuellement, il m&rsquo;aurait fallu faire beaucoup de copier/coller dans mon <span class="sc">svg</span>.
Simplement parce que la transformation est toujours la même, mais je ne pouvais pas dire, utiliser la transformation appelée &ldquo;titi&rdquo;.
Plutôt que copier du <span class="sc">xml</span>, j&rsquo;ai utilisé m4.</p>

<p>Et voici le code commenté&nbsp;:</p>

<div class="codefile"><a href="/Scratch/fr/blog/SVG-and-m4-fractals/code/yesodlogo.m4">&#x27A5; yesodlogo.m4</a></div>

<pre><code class="xml">&lt;?xml version="1.0" encoding="UTF-8" standalone="no"?&gt;
&lt;!--
     M4 Macros
define(`YTRANSFORMONE', `scale(.43) translate(-120,-69) rotate(-10)')
define(`YTRANSFORMTWO', `scale(.43) translate(-9,-67.5) rotate(10)')
define(`YTRANSFORMTHREE', `scale(.43) translate(53,41) rotate(120)')
define(`YGENTRANSFORM', `translate(364,274) scale(3)')
define(`YTRANSCOMPLETE', `
    &lt;g id="level_$1"&gt;
        &lt;use style="opacity: .8" transform="YTRANSFORMONE" xlink:href="#level_$2" /&gt;
        &lt;use style="opacity: .8" transform="YTRANSFORMTWO" xlink:href="#level_$2" /&gt;
        &lt;use style="opacity: .8" transform="YTRANSFORMTHREE" xlink:href="#level_$2" /&gt;
    &lt;/g&gt;
    &lt;use transform="YGENTRANSFORM" xlink:href="#level_$1" /&gt;
')
 --&gt;
&lt;svg 
    xmlns="http://www.w3.org/2000/svg" 
    xmlns:xlink="http://www.w3.org/1999/xlink"
    x="64" y="64" width="512" height="512" viewBox="64 64 512 512"
    id="svg2" version="1.1"&gt;
    &lt;g id="level_0"&gt; &lt;!-- some group, if I want to add other elements --&gt;
        &lt;!-- the text "λ" --&gt;
        &lt;text id="lambda" 
            fill="#333" style="font-family:Ubuntu; font-size: 100px"
            transform="rotate(180)"&gt;λ&lt;/text&gt;
    &lt;/g&gt;
    &lt;!-- the text "esod" --&gt;
    &lt;text 
        fill="#333" 
        style="font-family:Ubuntu; font-size: 28px; letter-spacing: -0.10em" 
        x="-17.3" 
        y="69" 
        transform="YGENTRANSFORM"&gt;esod&lt;/text&gt;
    &lt;!-- ROOT ELEMENT --&gt;
    &lt;use transform="YGENTRANSFORM" xlink:href="#level_0" /&gt;

    YTRANSCOMPLETE(1,0) &lt;!-- First recursion --&gt;
    YTRANSCOMPLETE(2,1) &lt;!-- deeper --&gt;
    YTRANSCOMPLETE(3,2) &lt;!-- deeper --&gt;
    YTRANSCOMPLETE(4,3) &lt;!-- even deeper --&gt;
    YTRANSCOMPLETE(5,4) &lt;!-- Five level seems enough --&gt;
&lt;/svg&gt;
</code></pre>

<p>et je l&rsquo;ai compile en <span class="sc">svg</span> et ensuite en <span class="sc">png</span> avec&nbsp;:</p>

<pre><code class="zsh">m4 yesodlogo.m4 &gt; yesodlogo.svg &amp;&amp; convert yesodlogo.svg yesodlogo.png
</code></pre>

<p>Le λ est dupliqué avec trois &ldquo;transformations&rdquo; différentes. Les transformations sont&nbsp;: <code>YTRANSFORMONE</code>, <code>YTRANSFORMTWO</code> et <code>YTRANSFORMTHREE</code>.</p>

<p>Chaque transformation est une similarité (translation + rotation + zoom, ce qui est équivalent à juste rotation + zoom, mais bon).</p>

<p>Une fois fixée chaque transformation peut ensuite être réutilisée pour chaque nouveau niveau.</p>

<p>Maintenant <code>YTRANSCOMPLETE</code> entre en jeu.
Cette macro prend deux arguments.
Le niveau courant et le niveau précédent.
Cette macro va dupliquer le niveau précédent en lui appliquant chacune des 3 transformations.
Au niveau 0, le contenu est un seul grand λ, le niveau 1 en contient 3. Le niveau 2 en contient 9, etc&hellip;
Le niveau 5 contient 3<sup>5</sup>=243 λ.
Tous les niveaux combinés représentent 3<sup>6</sup>-1 / 2 = 364 λ.</p>

<p>L&rsquo;avantage principal c&rsquo;est que je pouvais visualiser le résultat final facilement.
Sans ce système de macro, pour faire une preview il m&rsquo;aurait fallu faire des copier/coller + quelques modifications à chaque essai.</p>

<h2 id="conclusion">Conclusion</h2>

<p>Ce fut très amusant de faire une fractale en <span class="sc">svg</span>, mais la partie la plus intéressante était d&rsquo;augmenter la puissance d&rsquo;expressivité du langage en utilise un préprocesseur.
J&rsquo;ai utilisé cette méthode avec <span class="sc">xslt</span> pour une vrai application par exemple.
On peut aussi utiliser m4 pour faire des includes d&rsquo;autres fichiers.
Typiquement je l&rsquo;ai utiliser pour les includes dans un format obscur.
Mais vous pouvez aussi le considérer pour des includes dans du HTML.
Par exemple pour fabriquer un site statique rapidement, m4 peut se révéler utile pour inclure un footer ou un menu sur toutes les pages par exemple.
J&rsquo;ai aussi pensé que l&rsquo;on pouvait utiliser m4 pour structurer des programmes comme brainfuck.</p>

                </div>
                
                

                <div id="social">
                    <div class="left">  <a href="https://twitter.com/share" class="twitter-share-button" data-via="yogsototh">Tweet</a>
       <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="//platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>
     </div>
                    <div  class="left"> <div class="g-plusone" data-size="medium" data-annotation="inline" data-width="106"></div>
    <script type="text/javascript">
      (function() {
          var po = document.createElement('script'); po.type = 'text/javascript'; po.async = true;
          po.src = 'https://apis.google.com/js/plusone.js';
          var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(po, s);
      })();
    </script>
     </div>
                    <div class="flush"></div>
                </div>
                <div id="choixrss">
                    <a id="rss" href="http://feeds.feedburner.com/yannespositocomfr">
                        s'abonner
                    </a>
                </div>
                <script type="text/javascript">
                    $(document).ready(function(){ 
                            $('#comment').hide(); 
                            $('#clickcomment').click(showComments); 
                        });
                    function showComments() {
                        $('#comment').show();
                        $('#clickcomment').fadeOut();
                    }
                    document.write('<div id="clickcomment">Commentaires &amp; Partage</div>');
                </script>
                <div class="flush"></div>

                <div class="corps" id="comment">
                    <h2 class="first">commentaires</h2>
                    <noscript>
                        Vous devez activer javascript pour commenter.
                    </noscript>
                    
    <script type="text/javascript">
    var idcomments_acct = 'a307f0044511ff1b5cfca573fc0a52e7';
    var idcomments_post_id = '/Scratch/fr/blog/SVG-and-m4-fractals/';
    var idcomments_post_url = 'http://yannesposito.com/Scratch/fr/blog/SVG-and-m4-fractals/';
    </script>
    <span id="IDCommentsPostTitle" style="display:none"></span>
    <script type='text/javascript' src='/Scratch/js/genericCommentWrapperV2.js'></script>
    
                </div>

                <div id="entete" class="corps_spaced">
                    <div id="liens">
                        <ul><li><a href="/Scratch/fr/">Bienvenue</a></li>
<li><a href="/Scratch/fr/blog/">Blog</a></li>
<li><a href="/Scratch/fr/softwares/">Softwares</a></li>
<li><a href="/Scratch/fr/about/">À propos</a></li></ul>
                    </div>
                    <div class="flush"></div>
                    <hr/>
                    <div id="next_before_articles">
                        <div id="previous_articles">
                            articles précédents
                            
                            <div class="previous_article">
                                <a href="/Scratch/fr/blog/Yesod-excellent-ideas/"><span class="nicer">«</span>&nbsp;Les idées de yesod</a>
                            </div>
                            
                            
                            <div class="previous_article">
                                <a href="/Scratch/fr/blog/Higher-order-function-in-zsh/"><span class="nicer">«</span>&nbsp;Fonctions d'ordre supérieur en zsh</a>
                            </div>
                            
                            
                            <div class="previous_article">
                                <a href="/Scratch/fr/blog/programming-language-experience/"><span class="nicer">«</span>&nbsp;Mon expérience avec les languages de programmation</a>
                            </div>
                            
                            
                        </div>
                        <div id="next_articles">
                            articles suivants
                            
                            <div class="next_article">
                                <a href="/Scratch/fr/blog/Yesod-tutorial-for-newbies/">Site en Haskell&nbsp;<span class="nicer">»</span></a>
                            </div>
                            
                            
                            <div class="next_article">
                                <a href="/Scratch/fr/blog/Typography-and-the-Web/">La typography et le Web&nbsp;<span class="nicer">»</span></a>
                            </div>
                            
                            
                            <div class="next_article">
                                <a href="/Scratch/fr/blog/Haskell-the-Hard-Way/">Haskell comme un vrai!&nbsp;<span class="nicer">»</span></a>
                            </div>
                            
                            
                        </div>
                        <div class="flush"></div>
                    </div>
                </div>


                <div id="bottom">
                    <div>
                        <a href="https://twitter.com/yogsototh">Follow @yogsototh</a>
                    </div>
                    <div>
                        <a rel="license" href="http://creativecommons.org/licenses/by-sa/3.0/deed.fr">Droits de reproduction ©, Yann Esposito</a>
                    </div>
                    <div id="lastmod">
                        Écrit le : 20/10/2011
                        modifié le : 26/04/2012 
                    </div>
                    <div>
                        Site entièrement réalisé avec
                        <a href="http://www.vim.org">Vim</a>
                        et 
                        <a href="http://nanoc.stoneship.org">nanoc</a>
                    </div>
                </div>
                <div class="clear"></div>
            </div>
        </div>
    </body>
</html>